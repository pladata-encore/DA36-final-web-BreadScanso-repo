{% extends 'layout/store/base_store.html' %}
{% load static %}

{% block title %}Store | Member {% endblock title %}
{% block store_id%}store_id{% endblock store_id %}
{% block content %}
    <h3 style="margin-bottom: 50px;" class="text-center">회원관리</h3>
    <!-- 회원명 검색 -->
    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
        <input type="search" id="searchMember" placeholder="회원명을 입력하세요" style="padding: 10px; width: 250px; border: 1px solid #ccc; border-radius: 5px;">
        <button id="search_button" type="button" name="search_button" style="background-color: lightgoldenrodyellow; padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer;">
            검색
        </button>
    </div>
    <table class="table">
        <thead>
            <tr>
                <th scope="col"></th>
                <th scope="col">번호</th>
                <th scope="col">회원명</th>
                <th scope="col">아이디</th>
                <th scope="col">휴대폰번호</th>
                <th scope="col">성별</th>
                <th scope="col">연령대</th>
                <th scope="col">이메일</th>
                <th scope="col">방문횟수</th>
                <th scope="col">총 결제액</th>
                <th scope="col">회원가입일</th>
                <th scope="col">마지막 방문일</th>
                <th scope="col">포인트</th>
                <th scope="col">프로필사진</th>
                <th scope="col">수정/삭제</th>
            </tr>
        </thead>
        <tbody class="table-group-divider">
            {% for member in members %}
                <tr>
                    <td><input type="checkbox" class="member-checkbox" value="{{ member.id }}"></td>
                    <th scope="row">{{ forloop.counter }}</th> <!-- 회원 번호 -->
                    <td>{{ member.name }}</td> <!-- 회원명 -->
                    <td>{{ member.username }}</td> <!-- 아이디 -->
                    <td>{{ member.phone_number }}</td> <!-- 휴대폰번호 -->
                    <td>{{ member.gender }}</td> <!-- 성별 -->
                    <td>{{ member.age_group }}</td> <!-- 연령대 -->
                    <td>{{ member.email }}</td> <!-- 이메일 -->
                    <td>{{ member.visit_count }}</td> <!-- 방문횟수 -->
                    <td>{{ member.total_spent }} 원</td> <!-- 총 결제액 -->
                    <td>{{ member.join_date }}</td> <!-- 회원가입일 -->
                    <td>{{ member.last_visit_date }}</td> <!-- 마지막 방문일 -->
                    <td>{{ member.points }}</td> <!-- 포인트 -->
                    <td>
                        {% if member.profile_picture %}
                            <img src="{{ member.profile_picture.url }}" width="30">
                        {% else %}
                            null
                        {% endif %}
                    </td>
                    <td>
                        <button type="button" class="btn btn-light" onclick="toggleButton(this)">수정</button>
                    </td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="14">등록된 회원이 없습니다.</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
    <!-- 추가된 HTML 코드 아래에 그대로 위치 -->
{#    #}
{#    #}
{#            <h3 style="margin-bottom: 50px;" class="text-center">회원관리</h3>#}
{#            <!-- 회원명 검색 -->#}
{#            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">#}
{#                <input type="search" id="searchMember" placeholder="회원명을 입력하세요" style="padding: 10px; width: 250px; border: 1px solid #ccc; border-radius: 5px;">#}
{##}
{#                <button id="search_button" type="button" name="search_button" style="background-color: lightgoldenrodyellow; padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer;">#}
{#                    검색#}
{#                </button>#}
{#            </div>#}
{#            <table class="table">#}
{#              <thead>#}
{#                <tr>#}
{#                  <th scope="col"></th>#}
{#                  <th scope="col">번호</th>#}
{#                  <th scope="col">회원명</th>#}
{#                  <th scope="col">아이디</th>#}
{#                  <th scope="col">휴대폰번호</th>#}
{#                  <th scope="col">성별</th>#}
{#                  <th scope="col">연령대</th>#}
{#                  <th scope="col">이메일</th>#}
{#                  <th scope="col">방문횟수</th>#}
{#                  <th scope="col">총 결제액</th>#}
{#                  <th scope="col">회원가입일</th>#}
{#                  <th scope="col">마지막 방문일</th>#}
{#                  <th scope="col">포인트</th>#}
{#                  <th scope="col">프로필사진</th>#}
{#                  <th scope="col">수정/삭제</th>#}
{#                </tr>#}
{#              </thead>#}
{#              <tbody class="table-group-divider">#}
{#                <tr>#}
{#                  <td><input type="checkbox" class="member-checkbox" value="1"></td>#}
{#                  <th scope="row">1</th>#}
{#                  <td>홍길동</td>#}
{#                  <td>hong</td>#}
{#                  <td>01012345678</td>#}
{#                  <td>남성</td>#}
{#                  <td>20대</td>#}
{#                  <td>hong@naver.com</td>#}
{#                  <td>10</td>#}
{#                  <td>300,000</td>#}
{#                  <td>2025-01-01</td>#}
{#                  <td>2025-02-14</td>#}
{#                  <td>9,000</td>#}
{#                  <td>null</td>#}
{#                  <td><button type="button" class="btn btn-light" onclick="toggleButton(this)">수정</button></td>#}
                    <script>
                      function toggleButton(button) {
                        // 버튼 텍스트와 클래스 변경
                        if (button.innerText === "수정") {
                          button.innerText = "삭제";
                          button.classList.remove("btn-light");
                          button.classList.add("btn-danger");
                        } else {
                          button.innerText = "수정";
                          button.classList.remove("btn-danger");
                          button.classList.add("btn-light");
                        }
                      }
                    </script>
                </tr>
{#                <tr>#}
{#                  <td><input type="checkbox" class="member-checkbox" value="2"></td>#}
{#                  <th scope="row">2</th>#}
{#                  <td>고길동</td>#}
{#                  <td>dong</td>#}
{#                  <td>01011112222</td>#}
{#                  <td>남성</td>#}
{#                  <td>40대</td>#}
{#                  <td>dong@gmail.com</td>#}
{#                  <td>20</td>#}
{#                  <td>500,000</td>#}
{#                  <td>2024-09-10</td>#}
{#                  <td>2025-02-02</td>#}
{#                  <td>15,000</td>#}
{#                  <td><img src="{% static 'images/dong.png' %}" width="30"></td>#}
{#                </tr>#}
{#                <tr>#}
{#                  <td><input type="checkbox" class="member-checkbox" value="3"></td>#}
{#                  <th scope="row">3</th>#}
{#                  <td>하니</td>#}
{#                  <td>hani</td>#}
{#                  <td>01077778888</td>#}
{#                  <td>여성</td>#}
{#                  <td>10대</td>#}
{#                  <td>hani@naver.com</td>#}
{#                  <td>15</td>#}
{#                  <td>100,000</td>#}
{#                  <td>2024-10-14</td>#}
{#                  <td>2025-01-31</td>#}
{#                  <td>3,000</td>#}
{#                  <td>null</td>#}
{#                </tr>#}
{#                <tr>#}
{#                  <td><input type="checkbox" class="member-checkbox" value="4"></td>#}
{#                  <th scope="row">4</th>#}
{#                  <td></td>#}
{#                  <td></td>#}
{#                  <td></td>#}
{#                  <td></td>#}
{#                  <td></td>#}
{#                  <td></td>#}
{#                  <td></td>#}
{#                  <td></td>#}
{#                  <td></td>#}
{#                  <td></td>#}
{#                  <td></td>#}
{#                  <td></td>#}
{#                </tr>#}
{#                <tr>#}
{#                  <td><input type="checkbox" class="member-checkbox" value="5"></td>#}
{#                  <th scope="row">5</th>#}
{#                  <td></td>#}
{#                  <td></td>#}
{#                  <td></td>#}
{#                  <td></td>#}
{#                  <td></td>#}
{#                  <td></td>#}
{#                  <td></td>#}
{#                  <td></td>#}
{#                  <td></td>#}
{#                  <td></td>#}
{#                  <td></td>#}
{#                  <td></td>#}
{#                </tr>#}
{#              <tr>#}
{#                 <td><input type="checkbox" class="member-checkbox" value="6"></td>#}
{#                  <th scope="row">6</th>#}
{#                  <td></td>#}
{#                  <td></td>#}
{#                  <td></td>#}
{#                  <td></td>#}
{#                  <td></td>#}
{#                  <td></td>#}
{#                  <td></td>#}
{#                  <td></td>#}
{#                  <td></td>#}
{#                  <td></td>#}
{#                  <td></td>#}
{#                  <td></td>#}
{#                </tr>#}
{#              </tr>#}
{#              </tbody>#}
{#            </table>#}

            <!-- 삭제 버튼 -->
            <div class="member-container">
                <a class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteConfirmModal">삭제</a>
                <a type="button" class="btn btn-success signup-btn" onclick="location.href='{% url 'signup' %}'">신규등록</a>
            </div>


            <!-- 회원 삭제 팝업창 -->
            <div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="confirmSuccessLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="confirmSuccessLabel">회원삭제 안내</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            정말로 삭제하시겠습니까?
                        </div>
                        <div class="modal-footer">
                            <!-- 확인 버튼 -->
                            <button type="button" class="btn btn-danger" id="finalConfirmButton">확인</button>
                            <!-- 취소누르면 회원탈퇴 화면으로 return-->
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" onclick="location.href='{% url 'member_store' %}'">취소</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 회원삭제 두번째 팝업창 -->
            <div class="modal fade" id="finalModal" tabindex="-1" aria-labelledby="finalModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="finalModalLabel">탈퇴 완료</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            회원 삭제가 완료되었습니다.
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-primary" id="goHomeButton" onclick="location.href='{% url 'member_store' %}'">확인</button>
                        </div>
                    </div>
                </div>
            </div>
            <script>
                document.getElementById("finalConfirmButton").addEventListener("click", function () {
                    // 실제 삭제 요청을 서버에 보낼 수 있도록 수정 필요
                    alert("삭제가 완료되었습니다.");
                    window.location.href = "{% url 'member_store' %}"; // 삭제 후 이동할 페이지 설정
                });
            </script>


    {#  하단 페이지 넘김 버튼  #}
    <nav aria-label="..." style="margin-top:10%;">
      <ul class="pagination">
        <li class="page-item disabled">
          <a class="page-link">Previous</a>
        </li>
        <li class="page-item active" aria-current="page">
            <a class="page-link" href="#">1</a>
        </li>
        <li class="page-item"><a class="page-link" href="#">2</a></li>
        <li class="page-item"><a class="page-link" href="#">3</a></li>
        <li class="page-next">
          <a class="page-link" href="#">Next</a>
        </li>
      </ul>
    </nav>
{% endblock content %}

{% block script %}
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            let form = document.querySelector("form");
            let confirmButton = document.getElementById("confirmButton"); // 첫번째 팝업창 띄우는 버튼
            let finalConfirmButton = document.getElementById("finalConfirmButton"); // 두번째 팝업창 띄우는 버튼
            let goHomeButton = document.getElementById("goHomeButton"); // 홈으로 이동 버튼

            form.addEventListener("submit", function (event) {
                event.preventDefault(); // 기본 폼 제출 방지

                // 회원탈퇴 첫번째 표시
                let firstModal = new bootstrap.Modal(document.getElementById("confirmSuccessModal"));
                firstModal.show();
            });

            finalConfirmButton.addEventListener("click", function () {
                // 첫번째 팝업창 닫기
                let firstModal = bootstrap.Modal.getInstance(document.getElementById("confirmSuccessModal"));
                firstModal.hide();

                // 두번째 팝업창 표시
                let secondModal = new bootstrap.Modal(document.getElementById("finalModal"));
                secondModal.show();
            });

            goHomeButton.addEventListener("click", function () {
                window.location.href = "/";  // 홈 페이지로 이동
            });
        });
    </script>
{% endblock script %}
